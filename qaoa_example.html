<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="prev" title="Using BGLS to sample from Matrix Product State Circuits" href="mps_simulation.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Using BGLS with MPS to solve QAOA problems - BGLS documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">BGLS  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">BGLS  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="when_to_use.html">When to use <code class="docutils literal notranslate"><span class="pre">BGLS</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="using_custom_states.html">Using custom states with <code class="docutils literal notranslate"><span class="pre">BGLS</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How <code class="docutils literal notranslate"><span class="pre">BGLS</span></code> works</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips for using <code class="docutils literal notranslate"><span class="pre">BGLS</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="clifford_simulation.html">Using BGLS on Clifford and near-Clifford circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="mps_simulation.html">Using BGLS to sample from Matrix Product State Circuits</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Using BGLS with MPS to solve QAOA problems</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="using-bgls-with-mps-to-solve-qaoa-problems">
<h1>Using BGLS with MPS to solve QAOA problems<a class="headerlink" href="#using-bgls-with-mps-to-solve-qaoa-problems" title="Permalink to this heading">#</a></h1>
<p>For large sparse graphs, we expect matrix product states to be particularly efficient being that their runtime scales primarily in the (sparse) degree of connectedness. Here we will use such states with our bgls sampler to solve the MaxCut problem for random graphs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">sympy</span>

<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="kn">import</span> <span class="nn">cirq</span>
<span class="kn">import</span> <span class="nn">cirq.contrib.quimb</span> <span class="k">as</span> <span class="nn">ccq</span>
<span class="kn">import</span> <span class="nn">cirq.contrib.quimb.mps_simulator</span>
<span class="kn">from</span> <span class="nn">cirq.contrib.svg</span> <span class="kn">import</span> <span class="n">SVGCircuit</span>

<span class="kn">import</span> <span class="nn">quimb.tensor</span> <span class="k">as</span> <span class="nn">qtn</span>

<span class="kn">import</span> <span class="nn">bgls</span>
</pre></div>
</div>
</div>
</div>
<p>Here we define a function to compute bitstring amplitudes for a matrix product state. (Note, this is the same as found in <a class="reference internal" href="mps_simulation.html"><span class="doc std std-doc">mps_simulation</span></a>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cirq_mps_bitstring_probability</span><span class="p">(</span>
        <span class="n">mps</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">quimb</span><span class="o">.</span><span class="n">MPSState</span><span class="p">,</span> <span class="n">bitstring</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the probability of measuring the `bitstring` (|z⟩) in the</span>
<span class="sd">    &#39;cirq.contrib.quimb.MPSState&#39; mps.</span>
<span class="sd">    Args:</span>
<span class="sd">        mps: Matrix Product State as a &#39;cirq.contrib.quimb.MPSState&#39;.</span>
<span class="sd">        bitstring: Bitstring |z⟩ as a binary string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">M_subset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ai</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">M</span><span class="p">):</span>
        <span class="n">qubit_index</span> <span class="o">=</span> <span class="n">mps</span><span class="o">.</span><span class="n">i_str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># selecting the component with matching bitstring:</span>
        <span class="n">A_subset</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="n">qubit_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bitstring</span><span class="p">[</span><span class="n">i</span><span class="p">])})</span>
        <span class="n">M_subset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A_subset</span><span class="p">)</span>

    <span class="n">tensor_network</span> <span class="o">=</span> <span class="n">qtn</span><span class="o">.</span><span class="n">TensorNetwork</span><span class="p">(</span><span class="n">M_subset</span><span class="p">)</span>
    <span class="n">bitstring_amplitude</span> <span class="o">=</span> <span class="n">tensor_network</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bitstring_amplitude</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We first create a random graph with n nodes and connectivity p</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">rand_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">erdos_renyi_graph</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">rand_graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a6f60f503243f6c11ed96a1b74363d17747ea2ce3e1b79c09aefa30247af50f6.png" src="_images/a6f60f503243f6c11ed96a1b74363d17747ea2ce3e1b79c09aefa30247af50f6.png" />
</div>
</div>
<p>We then implement the cost hamiltonian translated to qubits <span class="math notranslate nohighlight">\(H_c = \frac{1}{2}\sum(1-Z_iZ_j)\)</span>, parametrized as <span class="math notranslate nohighlight">\(U_c=e^{i\gamma H_c}\)</span>, as well as the mixing hamiltonian <span class="math notranslate nohighlight">\(H_m = \sum X_i\)</span>, parametrized as <span class="math notranslate nohighlight">\(U_m=e^{i\beta H_m}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">config_energy</span><span class="p">(</span><span class="n">assignments</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">energy</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">assignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">assignments</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">energy</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">energy</span>


<span class="k">def</span> <span class="nf">obj_func</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="c1"># return the average energy for a results repetitions</span>
    <span class="k">def</span> <span class="nf">config_energy</span><span class="p">(</span><span class="n">assignments</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">assignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">assignments</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">energy</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">energy</span>

    <span class="n">assignments</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">result</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># convert to +- 1</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span>
        <span class="p">[</span><span class="n">config_energy</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span> <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">assignments</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">Uc</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">cirq</span><span class="o">.</span><span class="n">ZZ</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">**</span> <span class="n">gamma</span>


<span class="k">def</span> <span class="nf">Um</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">cirq</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="n">beta</span>


<span class="k">def</span> <span class="nf">construct_circuit</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">p_range</span><span class="p">,</span> <span class="n">gammas</span><span class="p">,</span> <span class="n">betas</span><span class="p">):</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p_range</span><span class="p">):</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uc</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">gammas</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Um</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">betas</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g1</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;g1&quot;</span><span class="p">)</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;b1&quot;</span><span class="p">)</span>

<span class="n">maxcut_circuit</span> <span class="o">=</span> <span class="n">construct_circuit</span><span class="p">(</span><span class="n">rand_graph</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">g1</span><span class="p">],</span> <span class="p">[</span><span class="n">b1</span><span class="p">])</span>
<span class="n">SVGCircuit</span><span class="p">(</span><span class="n">maxcut_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family &#39;Arial&#39; not found.
</pre></div>
</div>
<img alt="_images/5851b017acbb209063b50e055267603a3be31a79aaa68668249e12cb5083b39c.svg" src="_images/5851b017acbb209063b50e055267603a3be31a79aaa68668249e12cb5083b39c.svg" /></div>
</div>
<p>We find the optimal values of gamma and beta by sweeping across parameter combinations. Sampling repeatedly from the resultant circuits, and computing the final average energy for each, we pick the combination minimizing the energy. We can make use of symbols to call cirq’s <code class="docutils literal notranslate"><span class="pre">run_sweep</span></code> across a range of settings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngammas</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">nbetas</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">param_sweep</span> <span class="o">=</span> <span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">Linspace</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;g1&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                             <span class="n">length</span><span class="o">=</span><span class="n">ngammas</span><span class="p">)</span> <span class="o">*</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Linspace</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;b1&#39;</span><span class="p">,</span>
                                                             <span class="n">start</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                                             <span class="n">stop</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                                             <span class="n">length</span><span class="o">=</span><span class="n">nbetas</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">LowChi</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">quimb</span><span class="o">.</span><span class="n">MPSOptions</span><span class="p">):</span>
    <span class="n">max_bond</span> <span class="o">=</span> <span class="mi">3</span>


<span class="n">bgls_mps_sampler</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span>
    <span class="n">cirq</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">quimb</span><span class="o">.</span><span class="n">MPSState</span><span class="p">(</span>
        <span class="n">qubits</span><span class="o">=</span><span class="n">maxcut_circuit</span><span class="o">.</span><span class="n">all_qubits</span><span class="p">(),</span> <span class="n">initial_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">prng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(),</span> <span class="n">simulation_options</span><span class="o">=</span><span class="n">LowChi</span><span class="p">()</span>
    <span class="p">),</span>
    <span class="n">cirq</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span>
    <span class="n">cirq_mps_bitstring_probability</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">bgls_mps_sampler</span><span class="o">.</span><span class="n">run_sweep</span><span class="p">(</span><span class="n">maxcut_circuit</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param_sweep</span><span class="p">,</span>
                                     <span class="n">repetitions</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">results</span> <span class="o">=</span> <span class="n">bgls_mps_sampler</span><span class="o">.</span><span class="n">run_sweep</span><span class="p">(</span><span class="n">maxcut_circuit</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param_sweep</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                                      <span class="n">repetitions</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/cirq/sim/simulator.py:72,</span> in <span class="ni">SimulatesSamples.run_sweep</span><span class="nt">(self, program, params, repetitions)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span> <span class="k">def</span> <span class="nf">run_sweep</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="s1">&#39;cirq.AbstractCircuit&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="s1">&#39;cirq.Sweepable&#39;</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="s1">&#39;cirq.Result&#39;</span><span class="p">]:</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_sweep_iter</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/cirq/sim/simulator.py:103,</span> in <span class="ni">SimulatesSamples.run_sweep_iter</span><span class="nt">(self, program, params, repetitions)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span>         <span class="n">records</span><span class="p">[</span><span class="n">protocols</span><span class="o">.</span><span class="n">measurement_key_name</span><span class="p">(</span><span class="n">op</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">103</span>     <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span>         <span class="n">circuit</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">param_resolver</span><span class="o">=</span><span class="n">param_resolver</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="n">repetitions</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">106</span> <span class="k">yield</span> <span class="n">study</span><span class="o">.</span><span class="n">ResultDict</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">param_resolver</span><span class="p">,</span> <span class="n">records</span><span class="o">=</span><span class="n">records</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/bgls/simulator.py:125,</span> in <span class="ni">Simulator._run</span><span class="nt">(self, circuit, param_resolver, repetitions)</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="n">param_resolver</span> <span class="o">=</span> <span class="n">param_resolver</span> <span class="ow">or</span> <span class="n">cirq</span><span class="o">.</span><span class="n">ParamResolver</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="n">resolved_circuit</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">resolve_parameters</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">param_resolver</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">125</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="p">(</span><span class="n">resolved_circuit</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/bgls/simulator.py:148,</span> in <span class="ni">Simulator._sample</span><span class="nt">(self, circuit, repetitions)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="n">keys_to_bitstrings_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">needs_trajectories</span><span class="p">(</span><span class="n">circuit</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span>     <span class="c1"># Sample all bitstrings in one pass through the circuit.</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>     <span class="n">keys_to_bitstrings_list</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">148</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_sample_from_one_wavefunction_evolution</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>             <span class="n">circuit</span><span class="p">,</span> <span class="n">repetitions</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>     <span class="c1"># Sample one bitstring per trajectory.</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span>     <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/bgls/simulator.py:219,</span> in <span class="ni">Simulator._sample_from_one_wavefunction_evolution</span><span class="nt">(self, circuit, repetitions)</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_op</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span> <span class="c1"># Skip updating bitstrings for diagonal gates since they do not change</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> <span class="c1"># the probability distribution.</span>
<span class="ne">--&gt; </span><span class="mi">219</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">is_diagonal</span><span class="p">(</span><span class="n">kraus</span><span class="p">)</span> <span class="k">for</span> <span class="n">kraus</span> <span class="ow">in</span> <span class="n">cirq</span><span class="o">.</span><span class="n">kraus</span><span class="p">(</span><span class="n">op</span><span class="p">)):</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>     <span class="k">continue</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span> <span class="c1"># Memoize self._compute_probability.</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/cirq/protocols/kraus_protocol.py:154,</span> in <span class="ni">kraus</span><span class="nt">(val, default)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span>     <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">mixture_result</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span> <span class="n">unitary_getter</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;_unitary_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">154</span> <span class="n">unitary_result</span> <span class="o">=</span> <span class="bp">NotImplemented</span> <span class="k">if</span> <span class="n">unitary_getter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">unitary_getter</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span> <span class="k">if</span> <span class="n">unitary_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span> <span class="ow">and</span> <span class="n">unitary_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span>     <span class="k">return</span> <span class="p">(</span><span class="n">unitary_result</span><span class="p">,)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/cirq/ops/gate_operation.py:195,</span> in <span class="ni">GateOperation._unitary_</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span> <span class="n">getter</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gate</span><span class="p">,</span> <span class="s1">&#39;_unitary_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">194</span> <span class="k">if</span> <span class="n">getter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">195</span>     <span class="k">return</span> <span class="n">getter</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">196</span> <span class="k">return</span> <span class="bp">NotImplemented</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/cirq/ops/eigen_gate.py:342,</span> in <span class="ni">EigenGate._unitary_</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span>     <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span> <span class="n">e</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exponent</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">342</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span>     <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">344</span>         <span class="n">component</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="n">half_turns</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_shift</span><span class="p">))</span>
<span class="nn">    345         for half_turns, component</span> in <span class="ni">self._eigen_components</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">346</span>     <span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">347</span>     <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">348</span> <span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/numpy/core/fromnumeric.py:2313,</span> in <span class="ni">sum</span><span class="nt">(a, axis, dtype, out, keepdims, initial, where)</span>
<span class="g g-Whitespace">   </span><span class="mi">2310</span>         <span class="k">return</span> <span class="n">out</span>
<span class="g g-Whitespace">   </span><span class="mi">2311</span>     <span class="k">return</span> <span class="n">res</span>
<span class="ne">-&gt; </span><span class="mi">2313</span> <span class="k">return</span> <span class="n">_wrapreduction</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2314</span>                       <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.5/x64/lib/python3.11/site-packages/numpy/core/fromnumeric.py:88,</span> in <span class="ni">_wrapreduction</span><span class="nt">(obj, ufunc, method, axis, dtype, out, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span>             <span class="k">return</span> <span class="n">reduction</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">passkwargs</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">88</span> <span class="k">return</span> <span class="n">ufunc</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">passkwargs</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>We then find the combo with minimum energy by searching over all pairs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ngammas</span><span class="p">,</span> <span class="n">nbetas</span><span class="p">))</span>
<span class="n">max_energy</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">max_params</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">obj_func</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">rand_graph</span><span class="p">)</span>
    <span class="n">energies</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">ngammas</span><span class="p">),</span> <span class="n">i</span> <span class="o">%</span> <span class="n">nbetas</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span>
    <span class="k">if</span> <span class="n">max_energy</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">energy</span> <span class="o">&gt;</span> <span class="n">max_energy</span><span class="p">:</span>
        <span class="n">max_energy</span> <span class="o">=</span> <span class="n">energy</span>
        <span class="n">max_params</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ngammas</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">nbetas</span><span class="p">),</span>
               <span class="n">energies</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\beta$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\gamma$&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;energy&#39;)
</pre></div>
</div>
<img alt="_images/6cc616140673852dea2197765343ad264f6d3fc1664fe8425ad8891b189b3990.png" src="_images/6cc616140673852dea2197765343ad264f6d3fc1664fe8425ad8891b189b3990.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;max energy: &quot;</span><span class="p">,</span> <span class="n">max_energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;at params: &quot;</span><span class="p">,</span> <span class="n">max_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>max energy:  5.3
at params:  cirq.ParamResolver({&#39;g1&#39;: 0.2142857142857143, &#39;b1&#39;: 0.1})
</pre></div>
</div>
</div>
</div>
<p>Finally we fix the maximized parameters, repeatedly sample at this configuration, and then take as our graph solution the measurement with maximal energy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_at_max</span> <span class="o">=</span> <span class="n">bgls_mps_sampler</span><span class="o">.</span><span class="n">run_sweep</span><span class="p">(</span><span class="n">maxcut_circuit</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">max_params</span><span class="p">,</span>
                                           <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ngammas</span><span class="p">,</span> <span class="n">nbetas</span><span class="p">))</span>
<span class="n">max_best_energy</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_assignment</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result_at_max</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">result</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">config_energy</span><span class="p">(</span><span class="n">assignment</span><span class="p">,</span> <span class="n">rand_graph</span><span class="p">)</span>
        <span class="n">best_energies</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">ngammas</span><span class="p">),</span> <span class="n">i</span> <span class="o">%</span> <span class="n">nbetas</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span>
        <span class="k">if</span> <span class="n">max_best_energy</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">energy</span> <span class="o">&gt;</span> <span class="n">max_best_energy</span><span class="p">:</span>
            <span class="n">max_best_energy</span> <span class="o">=</span> <span class="n">energy</span>
            <span class="n">best_assignment</span> <span class="o">=</span> <span class="n">assignment</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;max best energy i.e. number of slices: &quot;</span><span class="p">,</span> <span class="n">max_best_energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with system configuration: &quot;</span><span class="p">,</span> <span class="n">best_assignment</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>max best energy i.e. number of slices:  9.0
with system configuration:  [-1. -1.  1.  1.  1. -1. -1. -1. -1. -1.]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodesa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">nodesb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="n">subset_color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rand_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodesa</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node_for_adding</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node_for_adding</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rand_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">subset_color</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">][</span><span class="s1">&#39;l&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/de758ba18d72d6d3951dbebfc7c1a20b511701841e03b72264027d528f3ca49d.png" src="_images/de758ba18d72d6d3951dbebfc7c1a20b511701841e03b72264027d528f3ca49d.png" />
</div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="mps_simulation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Using BGLS to sample from Matrix Product State Circuits</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Alex Shapiro, Ryan LaRose
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>