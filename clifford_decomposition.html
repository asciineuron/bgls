<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Clifford Decomposition - BGLS documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">BGLS  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">BGLS  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="when_to_use.html">When to use <code class="docutils literal notranslate"><span class="pre">BGLS</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="using_custom_states.html">Using custom states with <code class="docutils literal notranslate"><span class="pre">BGLS</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How <code class="docutils literal notranslate"><span class="pre">BGLS</span></code> works</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips for using <code class="docutils literal notranslate"><span class="pre">BGLS</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="clifford_simulation.html">Using BGLS on Clifford and near-Clifford circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="mps_simulation.html">Using BGLS to sample from Matrix Product State Circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="qaoa_example.html">Using BGLS with MPS to solve QAOA problems</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="clifford-decomposition">
<h1>Clifford Decomposition<a class="headerlink" href="#clifford-decomposition" title="Permalink to this heading">#</a></h1>
<p>Here we will use the <code class="docutils literal notranslate"><span class="pre">near_clifford_solver.circuit_clifford_decomposition</span></code> function, which returns a list of all <span class="math notranslate nohighlight">\(f*2^{\# non-Clifford}\)</span> circuits approximating a near-Clifford input, for fidelity f.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">cirq</span>
<span class="kn">import</span> <span class="nn">bgls</span>
<span class="kn">import</span> <span class="nn">bgls.testing</span>
</pre></div>
</div>
</div>
</div>
<p>First we just define some helper functions to quantify how well our results match either each other or the predicted distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">result_overlap</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">ResultDict</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">ResultDict</span><span class="p">):</span>
    <span class="c1"># returns the fraction of results in a matching those in b. i.e. go through every result in a, see if there&#39;s a new result that is the same in b</span>
    <span class="n">total_measurements</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">matching_measurements</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">used_b_indices</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># keep track so no double counting, unique results</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">gate_key</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">b_res</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="n">gate_key</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;key not found in second results&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">repa</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">total_measurements</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">repb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">repa</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">b_res</span><span class="p">[</span><span class="n">repb</span><span class="p">,</span>
                                        <span class="p">:])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">repb</span> <span class="ow">in</span> <span class="n">used_b_indices</span><span class="p">:</span>
                    <span class="n">matching_measurements</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">used_b_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repb</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="k">return</span> <span class="n">matching_measurements</span> <span class="o">/</span> <span class="n">total_measurements</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">theoretic_overlap</span><span class="p">(</span><span class="n">prob_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Result</span><span class="p">):</span>
    <span class="c1"># returns the percent overlap of sample results with the exact probability from the state vector</span>
    <span class="c1"># i.e. the fraction of our results that match the ideal sample distribution</span>
    <span class="n">num_matches</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;meas&quot;</span><span class="p">)</span>
    <span class="n">tot_samples</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">bitstr</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">theoretic_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prob_vec</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">bitstr</span><span class="p">)]</span> <span class="o">*</span> <span class="n">tot_samples</span><span class="p">)</span>
        <span class="n">num_matches</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">theoretic_cnt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">num_matches</span> <span class="o">/</span> <span class="n">tot_samples</span>


<span class="k">def</span> <span class="nf">exact_overlaps</span><span class="p">(</span><span class="n">prob_vec1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">prob_vec2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="c1"># gives the corresponding overlap for two final state vectors, to be used when one is an approximation</span>
    <span class="n">total_prob_match</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prob_vec1</span><span class="p">)):</span>
        <span class="n">total_prob_match</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">prob_vec1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">prob_vec2</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">total_prob_match</span>  <span class="c1">#(max possible is exact match hence total 1)</span>
</pre></div>
</div>
</div>
</div>
<p>We first show how we can sample from our expanded list of exact-Clifford circuits approximating the original near-Clifford:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize random circuit with e.g. Clifford+T gates:</span>
<span class="n">qubits</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">cirq</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">T</span><span class="p">}</span>
<span class="n">clifford_circuit</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">generate_random_circuit</span><span class="p">(</span>
    <span class="n">qubits</span><span class="p">,</span>
    <span class="n">n_moments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">op_density</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">gate_domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">clifford_circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;meas&quot;</span><span class="p">))</span>
<span class="c1"># and generate the strict Clifford expansion, keeping all terms:</span>
<span class="p">(</span><span class="n">expanded_circuits</span><span class="p">,</span>
 <span class="n">expanded_amplitudes</span><span class="p">)</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">near_clifford_solver</span><span class="o">.</span><span class="n">circuit_clifford_decomposition</span><span class="p">(</span>
    <span class="n">clifford_circuit</span><span class="p">,</span> <span class="n">fidelity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We compare sampling with cirq or bgls as we have done before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># strict sampling of the original circuit:</span>
<span class="n">cirq_sim</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Simulator</span><span class="p">()</span>
<span class="n">cirq_result</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">clifford_circuit</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">expanded_circuits</span><span class="p">))</span>  <span class="c1"># to match number of trials with expanded</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cirq_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">clifford_circuit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">final_state_vector</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">)</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">cirq_result</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">plot_state_histogram</span><span class="p">(</span><span class="n">cirq_result</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap with ideal distribution: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;final state vector: &quot;</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6f7c9b48a945b98ad382ef5a7ecf24bb5753d6dd9908b6f3029e0f345081edc0.png" src="_images/6f7c9b48a945b98ad382ef5a7ecf24bb5753d6dd9908b6f3029e0f345081edc0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>overlap with ideal distribution: 0.97825
final state vector:  [0.0732233 0.        0.0732233 0.        0.4267766 0.        0.4267766
 0.       ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first repeat randomly len(expanded_circuits) number of trials with our standard bgls near-clifford simulator, as per usual</span>
<span class="n">bgls_sim</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span>
    <span class="n">cirq</span><span class="o">.</span><span class="n">StabilizerChFormSimulationState</span><span class="p">(</span>
        <span class="n">qubits</span><span class="o">=</span><span class="n">qubits</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">),</span>
    <span class="n">bgls</span><span class="o">.</span><span class="n">apply</span><span class="o">.</span><span class="n">act_on_near_clifford</span><span class="p">,</span>
    <span class="n">bgls</span><span class="o">.</span><span class="n">born</span><span class="o">.</span><span class="n">compute_probability_stabilizer_state</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
<span class="n">bgls_result</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">clifford_circuit</span><span class="p">,</span>
                           <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expanded_circuits</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">plot_state_histogram</span><span class="p">(</span><span class="n">bgls_result</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">bgls_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap with ideal distribution: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9da053e84fb519aea0f77d3d64183b6589a13e45e32e1461595b05ac0d78df6a.png" src="_images/9da053e84fb519aea0f77d3d64183b6589a13e45e32e1461595b05ac0d78df6a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>overlap with ideal distribution: 0.646
</pre></div>
</div>
</div>
</div>
<p>We contrast this with running on each circuit in the expansion as follows. First we can try sampling from each, to ensure all paths are covered:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expanded_results</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">expanded_circuits</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">expanded_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expanded_results</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expanded_results</span> <span class="o">+=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">plot_state_histogram</span><span class="p">(</span><span class="n">expanded_results</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">expanded_results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap with ideal distribution: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0fc9896ed371639056b0c9f3dac637c069428d4b98961031b1808998209f3b06.png" src="_images/0fc9896ed371639056b0c9f3dac637c069428d4b98961031b1808998209f3b06.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>overlap with ideal distribution: 0.76575
</pre></div>
</div>
</div>
</div>
<p>We note that this may actually recreate the original distribution worse than repeated sampling from the original circuit. This is because whereas the latter yields samples distributed according to the relative amplitudes even if it doesn’t explore the entire space, this method samples from all paths equally, not capturing their varying amplitude. We can try to reincorporate this as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weighted_expanded_results</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
<span class="n">expanded_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">expanded_amplitudes</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expanded_circuits</span><span class="p">)):</span>
    <span class="n">chosen_circuit</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expanded_circuits</span><span class="p">),</span>
                                <span class="n">p</span><span class="o">=</span><span class="n">expanded_probabilities</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                                    <span class="n">expanded_probabilities</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">expanded_circuits</span><span class="p">[</span><span class="n">chosen_circuit</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">weighted_expanded_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weighted_expanded_results</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">weighted_expanded_results</span> <span class="o">+=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">plot_state_histogram</span><span class="p">(</span><span class="n">weighted_expanded_results</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">weighted_expanded_results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap with ideal distribution: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d1302f39e7202d387fcdb0dc8a96efae83c91221350229316021cdf87303881e.png" src="_images/d1302f39e7202d387fcdb0dc8a96efae83c91221350229316021cdf87303881e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>overlap with ideal distribution: 0.634
</pre></div>
</div>
</div>
</div>
<p>We know that our decomposition is optimal, but that does not mean it is always very good. We can pick a gate very close to clifford and see if results match the exact case better. For example Rz(theta=epsilon)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-8</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="p">,</span>
                  <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">common_gates</span><span class="o">.</span><span class="n">ZPowGate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="o">.</span><span class="n">exponent</span> <span class="o">==</span> <span class="mf">0.25</span><span class="p">:</span>
        <span class="n">qubits</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="n">rads</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">op</span>

<span class="n">Rze</span> <span class="o">=</span> <span class="n">clifford_circuit</span><span class="o">.</span><span class="n">map_operations</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="p">(</span><span class="n">expanded_Rze</span><span class="p">,</span>
 <span class="n">Rze_amplitudes</span><span class="p">)</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">near_clifford_solver</span><span class="o">.</span><span class="n">circuit_clifford_decomposition</span><span class="p">(</span>
    <span class="n">Rze</span><span class="p">,</span> <span class="n">fidelity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cirq_result</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Rze</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expanded_circuits</span><span class="p">))</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cirq_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">Rze</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">final_state_vector</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">plot_state_histogram</span><span class="p">(</span><span class="n">cirq_result</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">cirq_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap with ideal distribution: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cbd6c2d957dd41844b3e6c499428b5512e26e8bbb14802f1a2959253f4cb741b.png" src="_images/cbd6c2d957dd41844b3e6c499428b5512e26e8bbb14802f1a2959253f4cb741b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>overlap with ideal distribution: 0.98375
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bgls_result</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Rze</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expanded_circuits</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">plot_state_histogram</span><span class="p">(</span><span class="n">bgls_result</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">bgls_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overlap with ideal distribution: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/90598d9d269487aa00449cb96396dca69c21f1842ca688801606329ce7452df9.png" src="_images/90598d9d269487aa00449cb96396dca69c21f1842ca688801606329ce7452df9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>overlap with ideal distribution: 0.9845
</pre></div>
</div>
</div>
</div>
<p>We are now ready to quantify this and explore the larger behavior. First we create a Clifford+T circuit, as well as an exact Clifford circuit. We run over an increasing number of samples both circuits for both the exact cirq StateVector simulator and our bgls sampler (i.e. it is exact in the Clifford case and approximate in the Clifford+T case).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compq</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">cirq</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">T</span><span class="p">}</span>
<span class="n">comp_circuit</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">generate_random_circuit</span><span class="p">(</span>
    <span class="n">compq</span><span class="p">,</span>
    <span class="n">n_moments</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">op_density</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">gate_domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
<span class="n">comp_circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">compq</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;meas&quot;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="p">,</span>
                  <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">common_gates</span><span class="o">.</span><span class="n">ZPowGate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="o">.</span><span class="n">exponent</span> <span class="o">==</span> <span class="mf">0.25</span><span class="p">:</span>
        <span class="n">qubits</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cirq</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">op</span>

<span class="n">comp_circuit_clifford</span> <span class="o">=</span> <span class="n">comp_circuit</span><span class="o">.</span><span class="n">map_operations</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">bgls_sim</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span>
    <span class="n">cirq</span><span class="o">.</span><span class="n">StabilizerChFormSimulationState</span><span class="p">(</span>
        <span class="n">qubits</span><span class="o">=</span><span class="n">compq</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">),</span>
    <span class="n">bgls</span><span class="o">.</span><span class="n">apply</span><span class="o">.</span><span class="n">act_on_near_clifford</span><span class="p">,</span>
    <span class="n">bgls</span><span class="o">.</span><span class="n">born</span><span class="o">.</span><span class="n">compute_probability_stabilizer_state</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">cirq_sim</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Simulator</span><span class="p">()</span>

<span class="n">overlapscirq</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">overlapsbgls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">overlapscirq_clifford</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">overlapsbgls_clifford</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">reps</span><span class="p">:</span>
    <span class="n">ressim</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">comp_circuit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ressim</span><span class="o">.</span><span class="n">final_state_vector</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">comp_circuit</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="n">rep</span><span class="p">)</span>
    <span class="n">overlapscirq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
    <span class="n">resbgls</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">comp_circuit</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="n">rep</span><span class="p">)</span>
    <span class="n">overlapsbgls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">resbgls</span><span class="p">))</span>

    <span class="n">ressim_clifford</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">comp_circuit_clifford</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vec_clifford</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ressim_clifford</span><span class="o">.</span><span class="n">final_state_vector</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">res_clifford</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">comp_circuit_clifford</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="n">rep</span><span class="p">)</span>
    <span class="n">overlapscirq_clifford</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec_clifford</span><span class="p">,</span> <span class="n">res_clifford</span><span class="p">))</span>
    <span class="n">resbgls_clifford</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">comp_circuit_clifford</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="n">rep</span><span class="p">)</span>
    <span class="n">overlapsbgls_clifford</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec_clifford</span><span class="p">,</span> <span class="n">resbgls_clifford</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reps</span><span class="p">,</span> <span class="n">overlapscirq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cirq, exact T&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reps</span><span class="p">,</span> <span class="n">overlapsbgls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;bgls, approx T&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reps</span><span class="p">,</span> <span class="n">overlapscirq_clifford</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cirq, Clifford&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reps</span><span class="p">,</span> <span class="n">overlapsbgls_clifford</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;bgls, Clifford&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;repetitions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;overlap&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulator type and overlap vs. repetitions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/253647ae66a28eba1d0f1e13d9a1e117f915c408be8a8779fe26c500227e70ea.png" src="_images/253647ae66a28eba1d0f1e13d9a1e117f915c408be8a8779fe26c500227e70ea.png" />
</div>
</div>
<p>We see that all simulators tend towards 1.0 overlap with the ideal as the number of samples increases hence fluctuations decrease. However, while bgls follows cirq in the exact Clifford case, we see that the bgls lags in the Clifford+T circuit. This is the price we pay for simulating it as an exact-Clifford approximation (one would lose the benefit of working with a clifford simulator if using cirq).</p>
<p>Next we similarly sweep across the angle used in the Rz gate of the circuit, again running on the exact cirq sampler vs the Clifford-approximate bgls sampler.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overlapscirq</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">overlapsbgls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="p">,</span>
                      <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">common_gates</span><span class="o">.</span><span class="n">ZPowGate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="o">.</span><span class="n">exponent</span> <span class="o">==</span> <span class="mf">0.25</span><span class="p">:</span>
            <span class="n">qubits</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="n">rads</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">op</span>


    <span class="n">Rzi</span> <span class="o">=</span> <span class="n">comp_circuit</span><span class="o">.</span><span class="n">map_operations</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Rzi</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">ressim</span> <span class="o">=</span> <span class="n">cirq_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">Rzi</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ressim</span><span class="o">.</span><span class="n">final_state_vector</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">overlapscirq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>

    <span class="n">resbgls</span> <span class="o">=</span> <span class="n">bgls_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Rzi</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">overlapsbgls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theoretic_overlap</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">resbgls</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">overlapscirq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cirq, exact non-Clifford&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">overlapsbgls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;bgls, approx Clifford&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;rads&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;overlap&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;overlap vs. R(θ)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/135672aac81fbb2f40511a9a3064ffb3e08eb064c607add17cbe7de110191ad4.png" src="_images/135672aac81fbb2f40511a9a3064ffb3e08eb064c607add17cbe7de110191ad4.png" />
</div>
</div>
<p>We see there is a clear fluctuation in overlap as a function of Rz angle, as can be compared with a plot of the error metric used in the original paper.</p>
<p>Finally, we can investigate varying the fidelity of our exact Clifford expansion. For the bgls sampler this has no use, but with an exact <em>simulator</em> (e.g. cirq’s <code class="docutils literal notranslate"><span class="pre">simulate</span></code> vs <code class="docutils literal notranslate"><span class="pre">run</span></code> functions), one can fully simulate each of the sub circuits and sum the final state vector, allowing a speedup in exact simulation at the cost of output accuracy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cliffq</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="n">cirq</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">cirq</span><span class="o">.</span><span class="n">T</span><span class="p">}</span>
<span class="n">cliff_circuit</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">generate_random_circuit</span><span class="p">(</span>
    <span class="n">cliffq</span><span class="p">,</span>
    <span class="n">n_moments</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">op_density</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">gate_domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
<span class="n">cliff_circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">cliffq</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;meas&quot;</span><span class="p">))</span>

<span class="n">cirq_clifford_sim</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">CliffordSimulator</span><span class="p">()</span>
<span class="n">cirq_exact_sim</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Simulator</span><span class="p">()</span>
<span class="n">exact_sim</span> <span class="o">=</span> <span class="n">cirq_exact_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">cliff_circuit</span><span class="p">)</span>
<span class="n">exact_vec</span> <span class="o">=</span> <span class="n">exact_sim</span><span class="o">.</span><span class="n">final_state_vector</span>

<span class="n">overlaps</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">fidelities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">fidelity</span> <span class="ow">in</span> <span class="n">fidelities</span><span class="p">:</span>
    <span class="n">final_state_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">exact_vec</span><span class="p">)</span>
    <span class="p">(</span><span class="n">expanded_cliff</span><span class="p">,</span>
     <span class="n">cliff_amplitudes</span><span class="p">)</span> <span class="o">=</span> <span class="n">bgls</span><span class="o">.</span><span class="n">near_clifford_solver</span><span class="o">.</span><span class="n">circuit_clifford_decomposition</span><span class="p">(</span>
        <span class="n">cliff_circuit</span><span class="p">,</span> <span class="n">fidelity</span><span class="o">=</span><span class="n">fidelity</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expanded_cliff</span><span class="p">)):</span>
        <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">=</span> <span class="n">expanded_cliff</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cliff_amplitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">cirq_clifford_sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">final_state_vec</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">state</span><span class="o">.</span><span class="n">final_state</span><span class="o">.</span><span class="n">state_vector</span><span class="p">()</span>

    <span class="n">final_prob_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">final_state_vec</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">overlaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">exact_overlaps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">exact_vec</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">final_prob_vec</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fidelities</span><span class="p">,</span> <span class="n">overlaps</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/66e2a056f61a457c53bec81b339284f321fef258dcf46325c76abee15094bf6f.png" src="_images/66e2a056f61a457c53bec81b339284f321fef258dcf46325c76abee15094bf6f.png" />
</div>
</div>
<p>We thus see that retaining more terms in the expansion grants an increase in accuracy at the cost of increasing computational time. What is gained with such a decomposition is the ability to use more a efficient <em>pure-Clifford</em> simulator on each sub-circuit, allowing performance gains over exact simulation of the original non-Clifford circuit.</p>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Alex Shapiro, Ryan LaRose
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>